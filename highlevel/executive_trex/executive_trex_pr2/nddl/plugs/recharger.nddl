#include "plugs/recharge_controller.nddl"
#include "world_model/topological_map.nddl"

Recharger::Active{
  // Start the recharge controller
  starts(RechargeController.Holds rc);

  // Initialize control variables
  eq(rc.active, true);
  eq(rc.in_position, false);
  eq(rc.outlet_detected_coarse, false);
  eq(rc.outlet_detected_fine, false);
  eq(rc.recharged, false);
  eq(rc.plug_is_stowed, maybe);
  eq(rc.ready_to_plug_in, false);
  eq(rc.plug_in_hand, false);
  eq(rc.plugged_in, false);
  eq(rc.ready_to_grasp, false);
  eq(rc.arms_clear, false);

  // Initialize outlet state
  starts(outlet_state.Holds os);
  map_get_outlet_state(os.x, os.y, os.z, os.qx, os.qy, os.qz, os.qw, outlet_id);
  eq(os.frame_id, frame_id);
}

Recharger::Inactive {
  if(recharger == ABORTED){
    // Fail, indicating that the outlet was not accessible
    met_by(Active p);
    map_notify_outlet_blocked(p.outlet_id);
  }
}
