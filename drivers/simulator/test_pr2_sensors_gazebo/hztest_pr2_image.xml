<launch>
  <!-- Bring up the node we want to test. -->
  <include file="$(find pr2_gazebo)/pr2_empty.launch"/>

  <!-- load controllers -->
  <param name="base_controller/odom_publish_rate" value="10" />
  <node pkg="mechanism_control" type="spawner.py" args="$(find pr2_default_controllers)/base_controller.xml" output="screen"/>
  <node pkg="mechanism_control" type="spawner.py" args="$(find pr2_default_controllers)/gazebo_head_torso_lift_controller.xml" output="screen"/>
  <node pkg="mechanism_control" type="spawner.py" args="$(find pr2_experimental_controllers)/laser_tilt/laser_tilt_controller.xml" />
  <node pkg="pr2_mechanism_controllers" type="send_laser_traj_cmd_ms2.py" args="laser_tilt_controller" />

  <!-- start stereo -->
  <include file="$(find stereo_image_proc)/stereo.launch" />

  <!-- Run hztest -->
  <!-- Test for publication rate of 'stereo/cloud' topic -->
  <test test-name="hztest_test_stereo_cloud" pkg="rostest" type="hztest" time-limit="60" name="stereo_cloud_test">
    <!-- The topic to listen for -->
    <param name="topic" value="/stereo/cloud" />
    <!-- The expected publication rate [Hz].  Set to 0.0 to only check that
    at least one message is received. -->
    <param name="hz" value="20.0" />
    <!-- Acceptable error in the publication rate [Hz].  Ignored if hz is set
    to 0.0. -->
    <param name="hzerror" value="1.0" />
    <!-- Time to listen for [seconds] -->
    <param name="test_duration" value="2.0" />
    <!-- Whether each inter-message time interval should be checked against
    the expected publication rate and error bound [boolean].  If true, then
    the test will fail if the time elapsed between *any* two consecutive
    messages exceeded the specified limits.  If false, then we only check
    the average publication rate over the entire test.  Default: false. -->
    <param name="check_intervals" value="false" />    
  </test>

  <!-- Test for publication of 'left stereo camera image publish rate' topic -->
  <test test-name="hztest_test_stereo_left_image" pkg="rostest" type="hztest" time-limit="60" name="stereo_left_image_test">
    <param name="topic" value="/stereo/left/image" />
    <param name="hz" value="20.0" />
    <param name="hzerror" value="1.0" />
    <param name="test_duration" value="2.0" />
    <param name="check_intervals" value="false" />    
  </test>

  <!-- Test for publication of 'left stereo camera image publish rate' topic -->
  <test test-name="hztest_test_stereo_right_image" pkg="rostest" type="hztest" time-limit="60" name="stereo_right_image_test">
    <param name="topic" value="/stereo/right/image" />
    <param name="hz" value="20.0" />
    <param name="hzerror" value="1.0" />
    <param name="test_duration" value="2.0" />
    <param name="check_intervals" value="false" />    
  </test>

  <!-- Test for publication of 'raw_stereo' topic. -->
  <test test-name="hztest_test_raw_stereo" pkg="rostest" type="hztest" time-limit="50" name="raw_stereo_test">
    <!-- Note how we use a different parameter namespace and node name
    for this test (raw_stereo_test vs. scan_test). -->
    <param name="topic" value="/stereo/raw_stereo" />
    <param name="hz" value="20.0" />
    <param name="hzerror" value="1.0" />
    <param name="test_duration" value="2.0" />
    <param name="check_intervals" value="false" />
  </test>

</launch>
