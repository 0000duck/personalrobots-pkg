<launch>
  
  <include file="$(find pr2_defs)/pr2_planning_environment.launch" />
  <include file="$(find pr2_laser_tilt)/laser_tilt_controller.launch" />
  
  <node pkg="point_cloud_assembler" type="laser_scan_assembler_srv" output="screen"  name="laser_scan_assembler">
    <remap from="scan_in" to="tilt_scan"/>
    <param name="tf_cache_time_secs" type="double" value="10.0" />
    <param name="tf_tolerance_secs" type="double" value="0.0" />
    <param name="max_scans" type="int" value="400" />
    <param name="ignore_laser_skew" type="bool" value="true" />
    <param name="fixed_frame" type="string" value="torso_lift_link" />
    <param name="downsample_factor" type="int" value="2" />
  </node>
  
  <node pkg="point_cloud_assembler" type="point_cloud_snapshotter" output="screen" name="snapshotter">
    <remap from="laser_scanner_signal" to="laser_tilt_controller/laser_scanner_signal"/>
    <remap from="build_cloud" to="laser_scan_assembler/build_cloud" />
    <remap from="full_cloud" to="snapshot_cloud" />
  </node>
  
  <node pkg="new_robot_self_filter" type="self_filter" respawn="true" output="screen">
    <remap from="robot_description" to="robotdesc/pr2" />
    <remap from="cloud_in" to="snapshot_cloud" />
    <remap from="cloud_out" to="snapshot_cloud_filtered" />
  </node>

  
  <node pkg="laser_scan" type="scan_to_cloud" output="screen">
    <param name="scan_topic" type="string" value="tilt_scan" />
    <param name="scan_filters" textfile="$(find laser_scan)/default_scan_shadows.xml" />
    <param name="high_fidelity" type="bool" value="true" />
    <param name="cloud_topic" type="string" value="tilt_scan_cloud" />
  </node>
  
  <node pkg="new_robot_self_filter" type="self_filter" respawn="true" output="screen">
    <remap from="robot_description" to="robotdesc/pr2" />
    <remap from="cloud_in" to="tilt_scan_cloud" />
    <remap from="cloud_out" to="tilt_scan_cloud_filtered" />
  </node>
  
  <include file="$(find collision_map)/collision_map.launch" />
  
</launch>
